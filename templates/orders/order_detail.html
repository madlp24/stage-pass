{% extends "base.html" %}

{% block content %}
<a class="btn btn-link p-0 mb-3" href="{% url 'my_orders' %}">← Back to my orders</a>

<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <h1 class="h4 mb-0">Order #{{ order.id }}</h1>
      <span class="badge {% if order.status == 'PAID' %}bg-success{% elif order.status == 'PENDING' %}bg-warning text-dark{% else %}bg-secondary{% endif %}">
        {{ order.status }}
      </span>
    </div>

    <p class="text-muted mb-3">
      Placed on {{ order.created_at|date:"D, M j, Y · H:i" }}
    </p>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Ticket</th>
            <th class="text-center">Qty</th>
            <th class="text-end">Unit</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for it in order.items.all %}
          <tr>
            <td>
              <div class="fw-semibold">{{ it.ticket_type.event.title }}</div>
              <small class="text-muted">{{ it.ticket_type.name }}</small>
            </td>
            <td class="text-center">{{ it.qty }}</td>
            <td class="text-end">${{ it.unit_price }}</td>
            <td class="text-end">${{ it.unit_price|floatformat:2|add:"0"|floatformat:2|default:it.unit_price|yesno:""|default_if_none:"" }}{{ it.unit_price|mul:it.qty }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-muted">No items in this order.</td></tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3" class="text-end">Grand total</th>
            <th class="text-end">${{ order.total }}</th>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="mt-3">
      <a class="btn btn-outline-secondary" href="{% url 'event_list' %}">Continue browsing</a>
      <a class="btn btn-primary" href="{% url 'my_orders' %}">View all my orders</a>
    </div>
  </div>
</div>
{% endblock %}
