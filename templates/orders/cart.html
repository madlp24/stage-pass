{% extends "base.html" %}
{% block content %}
<h1 class="h3 mb-3">Your cart</h1>

{% if items %}
  <table class="table align-middle">
    <thead>
      <tr>
        <th>Ticket</th>
        <th class="text-end">Unit</th>
        <th class="text-center" style="width:160px">Qty</th>
        <th class="text-end">Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
        <tr>
          <td>
            <div class="fw-semibold">{{ it.ticket_type.name }}</div>
            <small class="text-muted">{{ it.ticket_type.event.title }}</small>
          </td>
          <td class="text-end">${{ it.unit_price }}</td>
          <td class="text-center">
            <form method="post" action="{% url 'cart_update' it.ticket_type.id %}" class="d-inline-flex gap-2 justify-content-center">
              {% csrf_token %}
              <input type="number" name="qty" min="0" value="{{ it.qty }}" class="form-control form-control-sm" style="width:90px">
              <button class="btn btn-sm btn-outline-secondary" type="submit">Update</button>
            </form>
          </td>
          <td class="text-end">${{ it.line_total }}</td>
          <td class="text-end">
            <form method="post" action="{% url 'cart_remove' it.ticket_type.id %}" class="d-inline">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger" type="submit">Remove</button>
                </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3" class="text-end">Grand total</th>
        <th class="text-end">${{ grand_total }}</th>
        <th></th>
      </tr>
    </tfoot>
  </table>

  {% if user.is_authenticated %}
    <a href="{% url 'checkout' %}" class="btn btn-primary">Checkout</a>
  {% else %}
    <a href="{% url 'login' %}?next={% url 'cart_detail' %}" class="btn btn-primary">Login to checkout</a>
  {% endif %}
{% else %}
  <div class="alert alert-info">Your cart is empty.</div>
{% endif %}
{% endblock %}
